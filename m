Return-Path: <linux-kbuild-owner@vger.kernel.org>
X-Original-To: lists+linux-kbuild@lfdr.de
Delivered-To: lists+linux-kbuild@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id E7E1F13108B
	for <lists+linux-kbuild@lfdr.de>; Mon,  6 Jan 2020 11:27:08 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726080AbgAFK1I (ORCPT <rfc822;lists+linux-kbuild@lfdr.de>);
        Mon, 6 Jan 2020 05:27:08 -0500
Received: from conssluserg-06.nifty.com ([210.131.2.91]:60795 "EHLO
        conssluserg-06.nifty.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725446AbgAFK1I (ORCPT
        <rfc822;linux-kbuild@vger.kernel.org>);
        Mon, 6 Jan 2020 05:27:08 -0500
Received: from mail-ua1-f41.google.com (mail-ua1-f41.google.com [209.85.222.41]) (authenticated)
        by conssluserg-06.nifty.com with ESMTP id 006AQxd8031185;
        Mon, 6 Jan 2020 19:27:00 +0900
DKIM-Filter: OpenDKIM Filter v2.10.3 conssluserg-06.nifty.com 006AQxd8031185
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=nifty.com;
        s=dec2015msa; t=1578306420;
        bh=8PkpWVUdySY51bUMOM4KhlKE4NHl+5/7vU1rEUIqJ74=;
        h=References:In-Reply-To:From:Date:Subject:To:Cc:From;
        b=t1xERg3M5OoLY8eI1HE1qeopn4zm+lDun8hAHIoNqc9Z/hSPLdU3iR75gK1mF0+/a
         NTo0YC5YG+e5yOwbtfBuQpfjSiU1dQffQVJtRDsK6ZaPoKiJojI66MKR9lbEhGC3Cs
         235PXWqYr2R+Z2ae8FTKbvArkKY6eaNRpvsTp0HrlTfd19t4KJkzzJ1JXSy+IWlXSi
         MTkkP/p3d7lwPbCnHBqEY8Np0AS8QAQXyTgizJzjkLsXBouRsowZP6cxyoyW6BWBkP
         /0HgC+zWk+5hfOwhwE6lutwpK1WZR/rWdTerM969zfjZ7AfMKCVAbsoHpKHU6svg1R
         Z9C8bijSGb4pw==
X-Nifty-SrcIP: [209.85.222.41]
Received: by mail-ua1-f41.google.com with SMTP id c7so13949644uaf.5;
        Mon, 06 Jan 2020 02:26:59 -0800 (PST)
X-Gm-Message-State: APjAAAX5aOjrTGuJQ7FpEio/XLMRpwsuGqal5dL+FPud11tXhdXSglQB
        QejvO11T7N/8eSxSbxOMK4G9G3tlfPCvSdjTyN0=
X-Google-Smtp-Source: APXvYqxgU3jMDo9bKZjHgpqMc+GLjt6jxilfwf2oNo2fDwQPFlGVv3FnjZk4Uygr+k8RNOj2/thH79yiUnmAOA0MjvY=
X-Received: by 2002:ab0:14ea:: with SMTP id f39mr49189518uae.40.1578306418628;
 Mon, 06 Jan 2020 02:26:58 -0800 (PST)
MIME-Version: 1.0
References: <20200104150238.19834-1-masahiroy@kernel.org> <20200104150238.19834-5-masahiroy@kernel.org>
 <xr93ftgt6ndv.fsf@gthelen.svl.corp.google.com>
In-Reply-To: <xr93ftgt6ndv.fsf@gthelen.svl.corp.google.com>
From:   Masahiro Yamada <masahiroy@kernel.org>
Date:   Mon, 6 Jan 2020 19:26:22 +0900
X-Gmail-Original-Message-ID: <CAK7LNAT2ai=-wbLmU2hqihbzVy7kKCGg=ipOK09XtSWiDYMW1Q@mail.gmail.com>
Message-ID: <CAK7LNAT2ai=-wbLmU2hqihbzVy7kKCGg=ipOK09XtSWiDYMW1Q@mail.gmail.com>
Subject: Re: [PATCH v2 04/13] initramfs: rename gen_initramfs_list.sh to gen_initramfs.sh
To:     Greg Thelen <gthelen@google.com>,
        Ben Hutchings <ben@decadent.org.uk>,
        "H. Peter Anvin" <hpa@zytor.com>
Cc:     Linux Kbuild mailing list <linux-kbuild@vger.kernel.org>,
        Andrew Morton <akpm@linux-foundation.org>,
        Sam Ravnborg <sam@ravnborg.org>,
        Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kbuild-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kbuild.vger.kernel.org>
X-Mailing-List: linux-kbuild@vger.kernel.org

(+CC Ben Hutchings, H. Peter Anvin)

In my understanding, the klibc build system is standalone.
So, the change in Linux kernel does not affect klibc at all.
Only the depending part is UAPI headers (make headers_install).

So, this patch
(https://lore.kernel.org/patchwork/patch/1175336/)
should be OK.

Please correct me if I am wrong.


On Mon, Jan 6, 2020 at 4:43 PM Greg Thelen <gthelen@google.com> wrote:
>
> Masahiro Yamada <masahiroy@kernel.org> wrote:
>
> > The comments in usr/Makefile wrongly refer to the script name (twice).
> >
> > Line 37:
> >     # The dependency list is generated by gen_initramfs.sh -l
> >
> > Line 54:
> >     # 4) Arguments to gen_initramfs.sh changes
> >
> > There does not exist such a script.
> >
> > I was going to fix the comments, but after some consideration, I thought
> > "gen_initramfs.sh" would be more suitable than "gen_initramfs_list.sh"
> > because it generates an initramfs image in the common usage.
> >
> > The script generates a list that can be fed to gen_init_cpio only when
> > it is directly run without -o or -l option.
> >
> > Signed-off-by: Masahiro Yamada <masahiroy@kernel.org>
> > ---
> >
> > Changes in v2: None
> >
> >  usr/Makefile                                    | 2 +-
> >  usr/{gen_initramfs_list.sh => gen_initramfs.sh} | 0
> >  2 files changed, 1 insertion(+), 1 deletion(-)
> >  rename usr/{gen_initramfs_list.sh => gen_initramfs.sh} (100%)
>
> Will this break klibc?  It might have a ref to the old name.
> https://git.kernel.org/pub/scm/libs/klibc/klibc.git/tree/usr/Kbuild#n55

I do not think so.

As I stated above, the klibc build system is independent of
any script in the Linux kernel.

The klibc Makefile refers to
scripts/gen_initramfs_list.sh, which does not exist.

My path is renaming
usr/gen_initramfs_list.sh to usr/gen_initramfs.sh


If the renaming had been problematic for klibc,
commit f6f57a46435d7253a52a1a07a58183678ad266a0
("initramfs: move gen_initramfs_list.sh from scripts/ to usr/")
would have already caused a problem.



Ben, Hans,
Is usr/Kbuild in klibc used?
If it is not used, is it better to delete it to avoid confusion?


Masahiro Yamada




> > diff --git a/usr/Makefile b/usr/Makefile
> > index 55c942da01cd..e44a66b8c051 100644
> > --- a/usr/Makefile
> > +++ b/usr/Makefile
> > @@ -24,7 +24,7 @@ $(obj)/initramfs_data.o: $(obj)/$(datafile_y) FORCE
> >  # Generate the initramfs cpio archive
> >
> >  hostprogs-y := gen_init_cpio
> > -initramfs   := $(CONFIG_SHELL) $(srctree)/$(src)/gen_initramfs_list.sh
> > +initramfs   := $(CONFIG_SHELL) $(srctree)/$(src)/gen_initramfs.sh
> >  ramfs-input := $(if $(filter-out "",$(CONFIG_INITRAMFS_SOURCE)), \
> >                       $(shell echo $(CONFIG_INITRAMFS_SOURCE)),-d)
> >  ramfs-args  := \
> > diff --git a/usr/gen_initramfs_list.sh b/usr/gen_initramfs.sh
> > similarity index 100%
> > rename from usr/gen_initramfs_list.sh
> > rename to usr/gen_initramfs.sh



-- 
Best Regards
Masahiro Yamada
