Return-Path: <linux-kbuild-owner@vger.kernel.org>
X-Original-To: lists+linux-kbuild@lfdr.de
Delivered-To: lists+linux-kbuild@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 303436EFFA
	for <lists+linux-kbuild@lfdr.de>; Sat, 20 Jul 2019 18:27:50 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726481AbfGTQ1t (ORCPT <rfc822;lists+linux-kbuild@lfdr.de>);
        Sat, 20 Jul 2019 12:27:49 -0400
Received: from conuserg-09.nifty.com ([210.131.2.76]:52417 "EHLO
        conuserg-09.nifty.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725940AbfGTQ1t (ORCPT
        <rfc822;linux-kbuild@vger.kernel.org>);
        Sat, 20 Jul 2019 12:27:49 -0400
Received: from grover.flets-west.jp (softbank126026094249.bbtec.net [126.26.94.249]) (authenticated)
        by conuserg-09.nifty.com with ESMTP id x6KGRfOq009136;
        Sun, 21 Jul 2019 01:27:41 +0900
DKIM-Filter: OpenDKIM Filter v2.10.3 conuserg-09.nifty.com x6KGRfOq009136
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=nifty.com;
        s=dec2015msa; t=1563640061;
        bh=Pv01/fNbqPnaUNjJtQ/RzZ1+tcdYQt0y1A77DCr4Efg=;
        h=From:To:Cc:Subject:Date:From;
        b=Bb3pmzApRABgiJM6+BQoQfdOqInJvXbY2nUhOGGf80+w1n3V8GvycdsgBsCJ2rA5f
         BIZLEs0k6vBzgmSClr5B2DcHnVrkpjY/O7YhC5xbZTU08VR9dtScAZs0gfm7/xXf27
         Kyucvr14YgPM/UexqQDxTw2mwDUDciMWZ9/t4qeiNeAdJXvQNk2A2vkP/WdKbC3Nm2
         pHoA6vknaX/ZrJalZ4docIWfo7zybpIyZ9+LMUpk4mSF5Vx0tlzu6jEls9Sd9XS8Ni
         0KTmLMBtwffVrhp9X5DkmduWtOYxzxaWpOJndpSo2gNvIHYCZLvUpUF8VoF7iZF2Bo
         yEQOteW+PPNhQ==
X-Nifty-SrcIP: [126.26.94.249]
From:   Masahiro Yamada <yamada.masahiro@socionext.com>
To:     linux-kbuild@vger.kernel.org
Cc:     Masahiro Yamada <yamada.masahiro@socionext.com>,
        Michal Marek <michal.lkml@markovi.net>,
        linux-kernel@vger.kernel.org
Subject: [PATCH 1/3] kbuild: use $(basename ...) for cmd_asn1_compiler
Date:   Sun, 21 Jul 2019 01:27:38 +0900
Message-Id: <20190720162740.4292-1-yamada.masahiro@socionext.com>
X-Mailer: git-send-email 2.17.1
Sender: linux-kbuild-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kbuild.vger.kernel.org>
X-Mailing-List: linux-kbuild@vger.kernel.org

$(basename ...) trims the last suffix. Using it is more intuitive in
my opinion.

This pattern rule makes %.asn1.c and %.asn1.h at the same time.
Previously, the short log showed only either of them, depending on
the target file in question.

To clarify that two files are being generated by the single recipe,
I changed the log as follows:

Before:

  ASN.1   crypto/asymmetric_keys/x509.asn1.c

After:

  ASN.1   crypto/asymmetric_keys/x509.asn1.[ch]

Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
---

 scripts/Makefile.build | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/scripts/Makefile.build b/scripts/Makefile.build
index 644431140434..7f71dbd180cb 100644
--- a/scripts/Makefile.build
+++ b/scripts/Makefile.build
@@ -388,9 +388,9 @@ $(obj)/%.lds: $(src)/%.lds.S FORCE
 
 # ASN.1 grammar
 # ---------------------------------------------------------------------------
-quiet_cmd_asn1_compiler = ASN.1   $@
+quiet_cmd_asn1_compiler = ASN.1   $(basename $@).[ch]
       cmd_asn1_compiler = $(objtree)/scripts/asn1_compiler $< \
-				$(subst .h,.c,$@) $(subst .c,.h,$@)
+				$(basename $@).c $(basename $@).h
 
 $(obj)/%.asn1.c $(obj)/%.asn1.h: $(src)/%.asn1 $(objtree)/scripts/asn1_compiler
 	$(call cmd,asn1_compiler)
-- 
2.17.1

