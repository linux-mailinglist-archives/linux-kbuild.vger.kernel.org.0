Return-Path: <linux-kbuild-owner@vger.kernel.org>
X-Original-To: lists+linux-kbuild@lfdr.de
Delivered-To: lists+linux-kbuild@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 4B41335AEE
	for <lists+linux-kbuild@lfdr.de>; Wed,  5 Jun 2019 13:14:20 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727196AbfFELOT (ORCPT <rfc822;lists+linux-kbuild@lfdr.de>);
        Wed, 5 Jun 2019 07:14:19 -0400
Received: from mx2.suse.de ([195.135.220.15]:53798 "EHLO mx1.suse.de"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1727183AbfFELOT (ORCPT <rfc822;linux-kbuild@vger.kernel.org>);
        Wed, 5 Jun 2019 07:14:19 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
        by mx1.suse.de (Postfix) with ESMTP id 7F914ACEE;
        Wed,  5 Jun 2019 11:14:17 +0000 (UTC)
From:   Jiri Slaby <jslaby@suse.cz>
To:     heiko.carstens@de.ibm.com
Cc:     linux-kernel@vger.kernel.org, Jiri Slaby <jslaby@suse.cz>,
        Masahiro Yamada <yamada.masahiro@socionext.com>,
        Michal Marek <michal.lkml@markovi.net>,
        linux-kbuild@vger.kernel.org, Vasily Gorbik <gor@linux.ibm.com>,
        Christian Borntraeger <borntraeger@de.ibm.com>,
        linux-s390@vger.kernel.org
Subject: [PATCH] kbuild: s390, do not remove autogenerated headers on clean
Date:   Wed,  5 Jun 2019 13:14:16 +0200
Message-Id: <20190605111416.13341-1-jslaby@suse.cz>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Sender: linux-kbuild-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kbuild.vger.kernel.org>
X-Mailing-List: linux-kbuild@vger.kernel.org

'make clean' does NOT remove autogenerated headers generated from
arch/s390/kernel/syscalls/. For example:
asm-offsets.h
irq_regs.h
irq_work.h
unistd_nr.h

But 'make clean' DOES currently remove dis-defs.h and facility-defs.h
generated from arch/s390/tools/.

The issue is that facility-defs.h is included from <asm/facility.h> and
builds of external modules fail due to missing header. (When cleaned
build directory is used.)

Fix this by adding these targets to no-clean-files.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
Cc: Masahiro Yamada <yamada.masahiro@socionext.com>
Cc: Michal Marek <michal.lkml@markovi.net>
Cc: linux-kbuild@vger.kernel.org
Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
Cc: Vasily Gorbik <gor@linux.ibm.com>
Cc: Christian Borntraeger <borntraeger@de.ibm.com>
Cc: linux-s390@vger.kernel.org
---

I would love to see comments from KBuild guys as I am not sure if this
fix is correct at all.

 arch/s390/tools/Makefile | 1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/s390/tools/Makefile b/arch/s390/tools/Makefile
index 2342b84b3386..984b2f43651e 100644
--- a/arch/s390/tools/Makefile
+++ b/arch/s390/tools/Makefile
@@ -7,6 +7,7 @@ kapi := arch/$(ARCH)/include/generated/asm
 kapi-hdrs-y := $(kapi)/facility-defs.h $(kapi)/dis-defs.h
 
 targets += $(addprefix ../../../,$(kapi-hdrs-y))
+no-clean-files += $(targets)
 PHONY += kapi
 
 kapi:	$(kapi-hdrs-y)
-- 
2.21.0

